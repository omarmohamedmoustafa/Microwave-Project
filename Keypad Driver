#include <C:\Keil\Labware\inc\tm4c123gh6pm.h>
#include "delay.h"

void PortC_Init(){
		SYSCTL_RCGCGPIO_R |= 0x04;        //Enable clock to PORTC and PORTE  
    while ((SYSCTL_RCGCGPIO_R&0x04)==0);  //wait for clock to be setted
    GPIO_PORTC_CR_R  |= 0xF0;             //Allow settings for all pins of PORTC
		GPIO_PORTE_AMSEL_R &= ~0xF0;
		GPIO_PORTE_AFSEL_R &= ~0xF0;
    GPIO_PORTC_DIR_R 	|=0xF0; // c out 
    GPIO_PORTC_DEN_R |= 0xF0;
	
           
}
void PortE_Init(){
	//column
		SYSCTL_RCGCGPIO_R |= 0x10;
		while((SYSCTL_PRGPIO_R & 0x10)==0);
		GPIO_PORTE_DIR_R &= ~0x0F; //set E0-E3 as input pins
		GPIO_PORTE_DIR_R |= 0x10;  //set E4 as output pin
		GPIO_PORTE_DEN_R |=0x1F;
		GPIO_PORTE_AMSEL_R &= ~0x1F;
		GPIO_PORTE_AFSEL_R &= ~0x1F;
		GPIO_PORTE_PDR_R |= 0x0F;
}

void row_activate(unsigned short column){//port c hena out (rows) try#3
		GPIO_PORTC_DATA_R = (1<<(column+4));
}
unsigned short portE_DATA(){
		return (GPIO_PORTE_DATA_R & 0x0F);
}
unsigned char matrix[4][4]={{'1','2','3','A'},{'4','5','6','B'},{'7','8','9','C'},{'*','0','#','D'}};

char keypad(void){
		while(1){
			unsigned short row,column;
				for (row=0;row<4;row++){
						row_activate(row);
						delay_us(2);
						for(column=0;column<4;column++){
								if(portE_DATA() & (1<<column)){
										return matrix[row][column];
								}
						}
				}
		}
}

